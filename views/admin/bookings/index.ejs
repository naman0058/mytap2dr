<%- include('../../layout.ejs') %>
<style>
  :root{ --brand:#0b76e0; --brand-ink:#0a5fb4; --ink:#0f172a; --muted:#64748b; --border:#e2e8f0; --bg:#f8fafc; --card:#fff; }
  body{background:var(--bg)}
  .page{max-width:1100px;margin:0 auto;padding:16px}
  .head{display:flex;flex-wrap:wrap;gap:10px;align-items:center;background:#eef6ff;border:1px solid #dbeafe;border-radius:16px;padding:12px;margin:6px 0 16px}
  .head h2{margin:0;color:var(--brand-ink)}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;text-decoration:none;color:var(--ink);font-weight:700}
  .btn.primary{background:var(--brand);color:#fff;border-color:transparent}
  .group{display:flex;gap:8px;flex-wrap:wrap}
  table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;border:1px solid var(--border);border-radius:16px;overflow:hidden}
  thead th{background:#f1f5ff;color:#0a5fb4;text-align:left;font-size:13px;padding:10px;border-bottom:1px solid var(--border)}
  tbody td{padding:10px;border-bottom:1px solid #f1f5f9;font-size:14px}
  tbody tr:last-child td{border-bottom:none}
  .status{font-size:12px;font-weight:800;border-radius:999px;padding:4px 10px;display:inline-block}
  .status.booked{background:#fff7ed;color:#7c2d12;border:1px solid #fed7aa}
  .status.completed{background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0}
  .status.cancelled{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
  .status.running{background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe}
</style>

<div class="page">
  <div class="head">
    <h2>My Appointments / मेरी अपॉइंटमेंट</h2>
    <span class="btn">Date / तारीख: <strong style="margin-left:6px"><%= date %></strong></span>
    <div class="group" style="margin-left:auto">
      <a class="btn" href="/admin/bookings?date=<%= new Date(new Date(date).setDate(new Date(date).getDate()-1)).toISOString().slice(0,10) %>">Yesterday</a>
      <a class="btn" href="/admin/bookings?date=<%= new Date().toISOString().slice(0,10) %>">Today</a>
      <a class="btn" href="/admin/bookings?date=<%= new Date(new Date(date).setDate(new Date(date).getDate()+1)).toISOString().slice(0,10) %>">Tomorrow</a>
      <a class="btn" href="/admin/download/today.csv">Download Today CSV</a>
      <form method="post" action="/admin/logout" style="display:inline"><button class="btn" type="submit">Logout</button></form>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Time</th>
          <th>Patient</th>
          <th>Phone</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <% if (!rows.length) { %>
          <tr><td colspan="8">No appointments for selected date.</td></tr>
        <% } %>
        <% rows.forEach(r => { %>
          <tr>
            <td><%= r.appointment_no %></td>
            <td><%= (r.appointment_time||'').slice(0,5) %></td>
            <td><%= r.patient_name %></td>
            <td><%= r.patient_phone %></td>
            
            <td><span class="status <%= (r.status||'').toLowerCase() %>"><%= r.status %></span></td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <p style="margin-top:10px;color:#64748b">Current Running / वर्तमान चल रहा: <strong><%= current_running_no %></strong></p>
  </div>
</div>
